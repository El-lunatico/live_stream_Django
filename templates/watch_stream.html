{% extends 'base.html' %}
{% block title %}View Stream{% endblock %}
{% block content %}
<div style="text-align: center; margin: 20px;">
    <h1>Live Stream: {{ stream_id }}</h1>
    <img id="webp-stream" 
         alt="Live Stream" 
         style="max-width: 90%; height: auto; border: 2px solid #000; border-radius: 8px; margin-top: 20px;" />
    <br>
    <a href="/" class="btn btn-primary mt-3" style="padding: 10px 20px; border-radius: 5px;">Back to Home</a>
</div>

<script>
    const streamElement = document.getElementById('webp-stream');
    const wsUrl = "{{ stream_url|escapejs }}"; // Safe WebSocket URL

    const ws = new WebSocket(wsUrl);

    ws.onopen = () => console.log('WebSocket connection established.');
    ws.onmessage = (event) => {
        try {
            const data = JSON.parse(event.data);
            const frameBase64 = data.frame;

            console.log("Received frame:", frameBase64); // Debug log

            streamElement.src = frameBase64; // Update the image source
        } catch (error) {
            console.error('Error parsing WebSocket message:', error);
        }
    };

    ws.onerror = (error) => console.error('WebSocket error:', error);
    ws.onclose = () => console.log('WebSocket connection closed.');
</script>

{% endblock %}
